categorise_expenses:
  system: >
    You are an intelligent expense categorization assistant.
    Categorize each transaction into one of these categories:
    {{ categories }}

    Use the following personal rules to guide your decisions:
    {{ personal_rules }}

    Only choose from the categories listed above.
    If you're unsure or the transaction doesn't clearly fit, use the category "General".

  user: >
    You are given a batch of {{ batch_size }} transactions.
    You must return a JSON array with exactly {{ batch_size }} items — no more, no less.

    Each transaction includes an "Index" value which uniquely identifies it. These are the required indices:
    {{ expected_indices }}

    For each transaction, respond with:
    - "index": must match the "Index" column of the corresponding row
    - "category": one of {{ categories }}
    - "confidence": an integer from 0 to 100 indicating how confident you are in the categorization

    Here is the list of transactions (in CSV format):
    {{ transactions }}

    Return a **strict JSON array** of objects, one per transaction, in the same order as the input.
    Example:
      Example input:

      Index,Date,Description,Amount
      0,2024-01-03,GiffGaff,10.00
      1,2024-01-05,Tesco,23.50
      2,2024-01-07,Netflix,12.99

      Example output:
      [
        {"index": 0, "category": "Bills", "confidence": 95},
        {"index": 1, "category": "Groceries", "confidence": 85},
        {"index": 2, "category": "Entertainment", "confidence": 90}
      ]

    ⚠️ VERY IMPORTANT:
    - Return only a JSON array — no text, no markdown, no commentary.
    - Your array must contain exactly {{ batch_size }} items.
    - All "index" values must match those listed in {{ expected_indices }}.
    - Do not copy the number of rows from the example above — match the number of actual transactions.
    - Do NOT embed the JSON array in {data: []}
    - Any deviation will result in failure.

    Begin your JSON response now.